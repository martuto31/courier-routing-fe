<div class="upload-container" (drop)="fileDrop($event)" (dragover)="dragOver($event)" (click)="openFile()">
  <input #uploadFile (change)="fileInput($event)" type="file" accept=".xlsx,.csv" hidden />

  <div class="upload-placeholder">
    <label class="upload-label">Избери файл или го пусни тук</label>
  </div>

  @if (selectedFile) {
    <div class="file-details" (click)="$event.stopPropagation()">
      <p>Избран файл: {{ selectedFile.name }}</p>

      @if (headers?.length) {
        <form [formGroup]="mapForm" class="mapping">
          <div class="checkbox-row row">
            <label>Има заглавен ред?</label>

            <input type="checkbox" formControlName="hasHeader" />
          </div>

          <div class="row">
            <label>Адрес колона *</label>

            <select formControlName="address">
              <option value="">-- Избери --</option>

              @for (header of headers; track $index) {
                <option [value]="header">{{ header }}</option>
              }
            </select>
          </div>

          <div class="row">
            <label>Приоритет колона (по избор)</label>

            <select formControlName="priority">
              <option value="">-- Няма --</option>

              @for (header of headers; track $index) {
                <option [value]="header">{{ header }}</option>
              }
            </select>
          </div>
        </form>

        <div class="preview">
          <div class="preview-title">Преглед (първите 5 реда)</div>

          <table>
            <thead>
              <tr>
                @for (header of headers; track $index) {
                  <th>{{ header }}</th>
                }
              </tr>
            </thead>
            <tbody>
              @for (row of previewRows; track $index) {
                <tr>
                  @for (cell of row; track $index) {
                    <td>{{ cell }}</td>
                  }
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <button class="send-button" [disabled]="mapForm.invalid" (click)="sendFile()">Изпрати файла</button>
    </div>
  }
</div>

@if (showNotGeocodedDialog) {
  <div class="modal-backdrop">
    <div class="modal">
      <h2>Неуспешно геокодирани адреси</h2>

      <p>Следните адреси не могат да бъдат намерени:</p>

      <ul>
        @for (parsedAddress of notGeocodedAddresses; track $index) {
          <li>
            <input [(ngModel)]="parsedAddress.address" />

            <button (click)="onRemoveAddress($index)">Пропусни</button>
          </li>
        }
      </ul>

      <div class="modal-actions">
        <button (click)="onCancel()">Отказ</button>
        <button (click)="sendFile()">Повтори геокодирането</button>
      </div>
    </div>
  </div>
}

@if (isLoading) {
  <div class="loader-container">
    <div class="loader"></div>
  </div>
}
